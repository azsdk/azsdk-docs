## Migrating from 'AzSDK' to 'AzSK'

<h4><font color="blue">IMPORTANT:</font></h4> 

> 1) If you are from Microsoft CSE, please use the steps [here](https://aka.ms/devopskit/migration). 
> <u>**Do not**</u> use the migration instructions on this page.
>> 
> 2) If you are external to Microsoft **and** you have setup your own org-policy server for AzSDK (using 
> `Install-AzSDKOrganizationPolicy` as covered [here](https://github.com/azsdk/azsdk-docs/tree/master/07-Customizing-AzSDK-for-your-Org)), 
please **do not** migrate your subscription(s) yet. Support for migrating org-policy based setups will be in the next sprint release. 
(Please watch this page for updates.) 
>
> 3) The steps below are only for orgs external to Microsoft CSE that have *not* setup their own org policy.

### Migration Steps:
The DevOps Kit PS module has been renamed from 'AzSDK' to 'AzSK'. (See 'FAQ' below for details.)

If you have been using the DevOps Kit for your subscriptions, you can switch to the new module by following
the steps below to migrate your subscription:

(Pre-requisite: You should be an **Owner** for the subscription being migrated.)

 0) Close all PS sessions. 

 1) Open a *fresh* PS session and install the latest release by running the command below (this will get 
 the new 'AzSK' module onto your machine):

	```PowerShell
	install-module AzSK -Scope CurrentUser
	```


 2) Close the installation session, open a *fresh* PS session and run the following:

	```PowerShell
	import-module AzSK
	Update-AzSKSubscriptionSecurity -SubscriptionId <sub_id> -Migrate
	```


This will make all changes necessary in your subscription in order to start using the new ('AzSK') module. 
If any of the individual steps fail, you can retry migration by just re-running the 'migrate' command 
(per Step-2 above). If that does not resolve it, please post a support query.

For other questions related to migration (e.g., *Why are we migrating? What happens behind the scenes during 
migration? What about CICD?* etc., please see the FAQ at the end of this page. 

**Note:** Until a subscription is migrated, you may be able to use the 'AzSDK' module and corresponding 'AzSDK' 
versions of cmdlets by installing the latest AzSDK module using `install-module AzSDK -Scope CurrentUser -AllowClobber` as always. 
However, after a subscription has been migrated, new 'AzSK' versions of the cmdlets 
in the new module should be used. The logs generated by local scan commands from the new module will appear 
under the `'%localappdata%\Microsoft\AzSKLogs'` folder


#### FAQ: 

##### Why are we migrating from AzSDK to AzSK?
We received feedback from various forums that the 'SDK' in the module name was misleading because 'SDK' is
traditionally used for 'Software Development Kit'. Secondly, some folks were also confusing 'AzSDK' and 'Azure SDK'
using the two interchangeably. 


##### What exactly happens during migration?
The migration process basically prepares your local machine and your subscription to start using the new
'AzSK' PS module. Depending on the subscription security features from the DevOps Kit you have setup on your 
subscription, the following steps happen during migration:

 - The old resource group ('AzSDKRG') will be retained for certain duration and locked for any modifications post migration
 - Attestation data/ Resource groups tags are auto migrated to the new resource group ('AzSKRG')
 - Attestation data is still retained in the old storage account as backup
 - Previously setup alerts, ARM policies and Continuous Assurance Automation Account will get deleted 
 and corresponding new resources will get created under AzSK RG.

If you created any other resources under the (old) DevOps Kit resource group ('AzSDKRG') you may need to migrate 
them yourselves.

##### How will the old cmdlets (from the old 'AzSDK' module) behave? 
If you have not yet migrated, all AzSDK cmdlets (Get-AzSDKxxx or Set-AzSDKxxx) will work as usual. The latest
version of AzSDK (2.11.x) will show warnings about migration.

Once you migrate your subscription, most cmdlets from AzSDK 2.11.x will report errors telling you to use 
cmdlets from the 'AzSK' module.

##### Can I use the new 'AzSK' module if I have not migrated?
Some commands (which are 'read only' in behavior) will work. However, others (e.g., attestation or Set-AzSKSubscriptionSecurity)
will be blocked. This is to not create conflicts with 'AzSDK-based' state in the subscription.

##### How will Continuous Assurance transition through migration?
If you have not yet migrated, the current AzSDK setup will seamlessly transition by updating the AzSDK module
to the latest AzSDK (version 2.11.x). Thus existing CA setups will not get impacted (scanning will continue as earlier).

Once you migrate, the migration process will create a new CA setup in the subscription using the same settings
that were provided when CA was setup originally. The new CA setup will be 'AzSK'-based and will import the 'AzSK'
module into the automation account. Thereafter, CA scanning will use 'AzSK' and will update to newer releases of 
'AzSK' module whenever they become available.

##### What about CICD extension?
The CICD extension has been revised to reflect the switch from 'AzSDK' to 'AzSK'. 
The previous extension will continue to work in the pipeline. Once a subscription has been migrated, you should
just go to the extension UI and select the newest version. 

If you have setup CICD in non-hosted mode, you may have to manually remove the older module as an additional step.

##### Are my old CA scan logs retained after migration?
Yes. We retain the old CA logs in the (old) storage account within 'AzSDKRG'. The migration process places a 'read'
lock on 'AzSDKRG'. Because of this, you may not be able to migrate to the storage account's blobs and view the logs.
Should you need to view any of the old logs, you can go to the 'AzSDK' resource group and view 'Locks' for it. 
Change the lock type from 'read-only' to 'delete' temporarily and download/view and logs you wish to. However, as soon 
as you can, please change the lock type back to 'read only'. This lock required so that other users using older 'AzSDK'
modules (prior to AzSDK 2.11.x) should not be able to write to the old RG once migration has been performed. 
